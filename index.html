<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2-Player PvP Game with Level Ups & Skins</title>
<style>
  body {
    margin:0; background:#222; color:#eee; font-family:sans-serif; user-select:none;
  }
  #gameCanvas {
    display:block;
    margin: 20px auto;
    background: linear-gradient(#5dade2, #1b4f72);
    border: 2px solid #ddd;
    image-rendering: pixelated;
  }
  #ui {
    width: 800px; margin: 0 auto; display:flex; justify-content: space-between; align-items:center;
  }
  #skinSelect {
    margin: 20px auto; width: 800px; display: flex; justify-content: center; gap: 20px;
  }
  .skin {
    width: 60px; height: 60px; border: 3px solid transparent; border-radius: 8px; cursor: pointer;
    display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:20px;
    user-select:none;
    transition: border-color 0.3s;
  }
  .skin.selected {
    border-color: gold;
  }
  button {
    padding: 8px 16px; font-size: 16px; cursor:pointer; border:none; border-radius:4px;
    background:#3498db; color:#fff; transition: background 0.3s;
  }
  button:hover {
    background:#2980b9;
  }
</style>
</head>
<body>

<div id="skinSelect">
  <div class="skin selected" data-player="1" data-skin="red" style="background:#e74c3c; color:#fff;">1</div>
  <div class="skin" data-player="1" data-skin="green" style="background:#27ae60; color:#fff;">1</div>
  <div class="skin" data-player="1" data-skin="blue" style="background:#2980b9; color:#fff;">1</div>
  <div class="skin" data-player="2" data-skin="purple" style="background:#8e44ad; color:#fff;">2</div>
  <div class="skin" data-player="2" data-skin="yellow" style="background:#f1c40f; color:#000;">2</div>
  <div class="skin" data-player="2" data-skin="orange" style="background:#d35400; color:#fff;">2</div>
</div>

<div id="ui">
  <div>
    <strong>Player 1 (WASD + F to shoot)</strong><br />
    Level: <span id="p1Level">1</span> XP: <span id="p1XP">0</span> Lives: <span id="p1Lives">3</span> Health: <span id="p1Health">100</span>
  </div>
  <div>
    <strong>Player 2 (Arrow Keys + / to shoot)</strong><br />
    Level: <span id="p2Level">1</span> XP: <span id="p2XP">0</span> Lives: <span id="p2Lives">3</span> Health: <span id="p2Health">100</span>
  </div>
</div>

<canvas id="gameCanvas" width="800" height="400"></canvas>
<button id="restartBtn" style="display:none; margin:20px auto; display:block;">Restart Game</button>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const restartBtn = document.getElementById('restartBtn');
  const skinSelect = document.getElementById('skinSelect');
  const keys = {};
  document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
  document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

  // Player skins data
  const skinColors = {
    red: '#e74c3c',
    green: '#27ae60',
    blue: '#2980b9',
    purple: '#8e44ad',
    yellow: '#f1c40f',
    orange: '#d35400',
  };

  // Player constructor
  function Player(x, y, controls, skinKey) {
    this.x = x;
    this.y = y;
    this.width = 40;
    this.height = 60;
    this.vx = 0;
    this.vy = 0;
    this.speed = 5;
    this.jumpPower = 15;
    this.onGround = false;
    this.color = skinColors[skinKey] || 'white';
    this.health = 100;
    this.lives = 3;
    this.level = 1;
    this.xp = 0;
    this.controls = controls;
    this.skinKey = skinKey;
    this.facing = 1; // 1=right, -1=left
    this.projectiles = [];
    this.attackCooldown = 0;
  }
  Player.prototype.draw = function() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
  };
  Player.prototype.move = function(platforms) {
    if(this.lives <= 0) return; // dead no move

    // Horizontal Movement
    if(keys[this.controls.left]) {
      this.vx = -this.speed;
      this.facing = -1;
    } else if(keys[this.controls.right]) {
      this.vx = this.speed;
      this.facing = 1;
    } else {
      this.vx = 0;
    }

    // Jump
    if(keys[this.controls.up] && this.onGround) {
      this.vy = -this.jumpPower;
      this.onGround = false;
    }

    // Gravity
    this.vy += 0.8;
    if(this.vy > 15) this.vy = 15;

    // Apply velocity
    this.x += this.vx;
    this.y += this.vy;

    // Simple floor collision
    this.onGround = false;
    platforms.forEach(p => {
      if(this.x < p.x + p.width && this.x + this.width > p.x &&
         this.y < p.y + p.height && this.y + this.height > p.y) {
        // Collision detected, resolve:
        if(this.vy > 0 && this.y + this.height - this.vy <= p.y) {
          this.y = p.y - this.height;
          this.vy = 0;
          this.onGround = true;
        } else if(this.vy < 0 && this.y >= p.y + p.height - this.vy) {
          this.y = p.y + p.height;
          this.vy = 0;
        } else if(this.vx > 0) {
          this.x = p.x - this.width;
        } else if(this.vx < 0) {
          this.x = p.x + p.width;
        }
      }
    });

    // Keep inside canvas bounds
    if(this.x < 0) this.x = 0;
    if(this.x + this.width > canvas.width) this.x = canvas.width - this.width;
    if(this.y > canvas.height) { // Fell off
      this.loseLife();
    }

    // Attack cooldown decrement
    if(this.attackCooldown > 0) this.attackCooldown--;
  };
  Player.prototype.shoot = function() {
    if(this.lives <= 0) return; // dead no shoot
    if(this.attackCooldown > 0) return;
    const projSpeed = 10;
    const projSize = 10;
    this.projectiles.push({
      x: this.x + (this.facing === 1 ? this.width : -projSize),
      y: this.y + this.height / 2 - projSize/2,
      vx: this.facing * projSpeed,
      vy: 0,
      width: projSize,
      height: projSize,
      owner: this
    });
    this.attackCooldown = 20; // cooldown frames
  };
  Player.prototype.loseLife = function() {
    if(this.lives > 0) {
      this.lives--;
      this.health = 100;
      // Respawn
      if(this === player1) {
        this.x = 100; this.y = 300;
      } else {
        this.x = 600; this.y = 300;
      }
      if(this.lives <= 0) {
        this.health = 0;
      }
    }
  };
  Player.prototype.takeDamage = function(dmg, fromPlayer) {
    if(this.lives <= 0) return;
    this.health -= dmg;
    if(this.health <= 0) {
      this.loseLife();
      if(fromPlayer && fromPlayer !== this) {
        fromPlayer.gainXP(20);
      }
    }
  };
  Player.prototype.gainXP = function(amount) {
    this.xp += amount;
    const needed = 100 + this.level * 50;
    if(this.xp >= needed) {
      this.xp -= needed;
      this.level++;
      this.health = 100;
      this.lives++;
    }
  };

  // Platforms array
  const platforms = [
    {x: 0, y: 360, width: 800, height: 40},
    {x: 200, y: 300, width: 120, height: 20},
    {x: 500, y: 250, width: 120, height: 20},
    {x: 350, y: 200, width: 120, height: 20},
  ];

  // Create players
  let player1 = new Player(100, 300, {left:'a', right:'d', up:'w', attack:'f'}, 'red');
  let player2 = new Player(600, 300, {left:'arrowleft', right:'arrowright', up:'arrowup', attack:'/'}, 'purple');

  // Update UI function
  function updateUI() {
    document.getElementById('p1Level').textContent = player1.level;
    document.getElementById('p1XP').textContent = player1.xp;
    document.getElementById('p1Lives').textContent = player1.lives;
    document.getElementById('p1Health').textContent = player1.health > 0 ? player1.health : 0;

    document.getElementById('p2Level').textContent = player2.level;
    document.getElementById('p2XP').textContent = player2.xp;
    document.getElementById('p2Lives').textContent = player2.lives;
    document.getElementById('p2Health').textContent = player2.health > 0 ? player2.health : 0;
  }

  // Handle projectiles
  function handleProjectiles() {
    [player1, player2].forEach(p => {
      p.projectiles.forEach((proj, i) => {
        proj.x += proj.vx;
        proj.y += proj.vy;
        // Remove if offscreen
        if(proj.x < 0 || proj.x > canvas.width) {
          p.projectiles.splice(i,1);
          return;
        }
        // Check collision with other player
        let other = (p === player1) ? player2 : player1;
        if(other.lives > 0 && proj.x < other.x + other.width && proj.x + proj.width > other.x &&
          proj.y < other.y + other.height && proj.y + proj.height > other.y) {
          other.takeDamage(20, p);
          p.projectiles.splice(i,1);
        }
      });
    });
  }

  // Draw platforms
  function drawPlatforms() {
    ctx.fillStyle = '#666';
    platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));
  }

  // Draw projectiles
  function drawProjectiles() {
    [player1, player2].forEach(p => {
      ctx.fillStyle = p.color;
      p.projectiles.forEach(proj => {
        ctx.fillRect(proj.x, proj.y, proj.width, proj.height);
      });
    });
  }

  // Game over check
  function checkGameOver() {
    if(player1.lives <= 0 || player2.lives <= 0) {
      restartBtn.style.display = 'block';
    }
  }

  // Game loop
  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawPlatforms();

    player1.move(platforms);
    player2.move(platforms);

    // Handle shooting keys
    if(keys[player1.controls.attack]) player1.shoot();
    if(keys[player2.controls.attack]) player2.shoot();

    handleProjectiles();

    player1.draw();
    player2.draw();
    drawProjectiles();

    updateUI();
    checkGameOver();

    requestAnimationFrame(gameLoop);
  }

  // Restart game
  restartBtn.onclick = () => {
    player1 = new Player(100, 300, player1.controls, player1.skinKey);
    player2 = new Player(600, 300, player2.controls, player2.skinKey);
    restartBtn.style.display = 'none';
  };

  // Skin selection handling
  skinSelect.addEventListener('click', e => {
    const skinDiv = e.target.closest('.skin');
    if(!skinDiv) return;

    const playerNum = parseInt(skinDiv.dataset.player);
    const skinKey = skinDiv.dataset.skin;

    // Deselect old skins for that player
    [...skinSelect.children].forEach(s => {
      if(parseInt(s.dataset.player) === playerNum) s.classList.remove('selected');
    });
    skinDiv.classList.add('selected');

    if(playerNum === 1) {
      player1.color = skinColors[skinKey];
      player1.skinKey = skinKey;
    } else if(playerNum === 2) {
      player2.color = skinColors[skinKey];
      player2.skinKey = skinKey;
    }
  });

  gameLoop();
})();
</script>
</body>
</html>
